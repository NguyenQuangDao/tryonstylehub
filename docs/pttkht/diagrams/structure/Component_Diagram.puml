@startuml
title Sơ đồ Component (Kiến trúc hệ thống)
left to right direction

node "Next.js App" as WebApp {
  component "Pages & UI" as Pages
  component "UI Components" as UI
}

package "API Routes (app/api)" as API {
  component "auth" as API_Auth
  component "tokens" as API_Tokens
  component "seller" as API_Seller
  component "admin" as API_Admin
  component "products" as API_Products
  component "recommend" as API_Recommend
  component "upload" as API_Upload
  component "avatar" as API_Avatar
  component "tryon" as API_TryOn
  component "user/gallery" as API_UserGallery
  component "virtual-models" as API_VirtualModels
  component "body-parts" as API_BodyParts
  component "blog" as API_Blog
  component "health" as API_Health
  component "cost-stats" as API_CostStats
  component "generate-image" as API_GenImage
  component "generate-prompt" as API_GenPrompt
  component "image-proxy" as API_ImageProxy
  component "health/stripe" as API_HealthStripe
}

package "Lib Services (src/lib)" as Lib {
  component "Auth" as S_Auth
  component "OpenAIService" as S_OpenAI
  component "CostTracker" as S_Cost
  component "Cache" as S_Cache
  component "ApiResponseUtils" as S_ApiResp
  component "ApiGuards" as S_Guards
  component "PrismaClient" as S_Prisma
}

database "MySQL" as DB
cloud "Stripe" as Stripe
cloud "AWS S3" as S3
cloud "OpenAI" as OpenAI
cloud "OpenRouter" as OpenRouter

WebApp --> API : HTTP (fetch)
Pages --> API_Auth
Pages --> API_Products
Pages --> API_Recommend
Pages --> API_Upload
Pages --> API_Tokens
Pages --> API_TryOn
Pages --> API_UserGallery
Pages --> API_VirtualModels
Pages --> API_Blog

API_Auth --> S_Auth
API_Tokens --> Stripe
API_Tokens --> S_Cost
API_Tokens --> S_Prisma
API_Products --> S_Prisma
API_Seller --> S_Prisma
API_Admin --> S_Prisma
API_Recommend --> S_OpenAI
API_Recommend --> S_Cache
API_Upload --> S3
API_Avatar --> S3
API_TryOn --> S_OpenAI
API_TryOn --> S_Cost
API_GenImage --> S_OpenAI
API_GenImage --> S_Cost
API_GenImage --> S3
API_GenImage --> S_Prisma
API_GenPrompt --> OpenRouter
API_GenPrompt --> S_Prisma
API_ImageProxy --> "Remote HTTP"
API_UserGallery --> S_Prisma
API_VirtualModels --> S_Prisma
API_BodyParts --> S_Cache
API_Blog --> S_Prisma
API_Health --> S_Guards
API_HealthStripe --> Stripe
API_CostStats --> S_Cost

S_Prisma --> DB : Prisma ORM
S_OpenAI --> OpenAI : SDK

note right of API
Thư mục: src/app/api/*
end note

note right of Lib
Thư mục: src/lib/*
end note

@enduml
