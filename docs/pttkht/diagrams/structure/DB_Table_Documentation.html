<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Tài liệu bảng Database</title>
  <style>
    body { font-family: Arial, sans-serif; line-height: 1.5; margin: 24px; }
    h1 { font-size: 22px; margin-bottom: 8px; }
    h2 { font-size: 18px; margin-top: 24px; margin-bottom: 8px; }
    p { margin: 6px 0; }
    table { border-collapse: collapse; width: 100%; margin-top: 8px; }
    th, td { border: 1px solid #888; padding: 6px 8px; font-size: 13px; }
    th { background: #f2f2f2; text-align: left; }
    .note { color: #333; font-size: 12px; }
  </style>
  <meta name="generator" content="Trae IDE" />
</head>
<body>
  <h1>Tài liệu các bảng (MySQL) dựa trên schema Prisma</h1>
  <p class="note">Nguồn: <code>prisma/schema.prisma</code> và <code>docs/pttkht/diagrams/structure/DB_Diagram.puml</code>.</p>

  <h2>Bảng User</h2>
  <p>Mục đích: lưu thông tin người dùng, phân quyền và số dư token.</p>
  <table>
    <thead>
      <tr><th>Trường</th><th>Kiểu dữ liệu</th><th>Độ lớn</th><th>Mô tả</th></tr>
    </thead>
    <tbody>
      <tr><td>id</td><td>varchar</td><td>255</td><td>Khóa chính, mặc định <code>cuid()</code>.</td></tr>
      <tr><td>email</td><td>varchar</td><td>255</td><td>Unique.</td></tr>
      <tr><td>password</td><td>varchar</td><td>255</td><td>Không null.</td></tr>
      <tr><td>name</td><td>varchar</td><td>255</td><td>Không null.</td></tr>
      <tr><td>avatarUrl</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>role</td><td>enum</td><td>-</td><td>Giá trị: ADMIN, USER, SELLER. Index. Mặc định USER.</td></tr>
      <tr><td>tokenBalance</td><td>int</td><td>-</td><td>Mặc định 0.</td></tr>
      <tr><td>createdAt</td><td>datetime</td><td>-</td><td>Mặc định <code>now()</code>.</td></tr>
      <tr><td>updatedAt</td><td>datetime</td><td>-</td><td>Tự động cập nhật.</td></tr>
    </tbody>
  </table>

  <h2>Bảng Shop</h2>
  <p>Mục đích: lưu cửa hàng thuộc người bán.</p>
  <table>
    <thead><tr><th>Trường</th><th>Kiểu dữ liệu</th><th>Độ lớn</th><th>Mô tả</th></tr></thead>
    <tbody>
      <tr><td>id</td><td>varchar</td><td>255</td><td>Khóa chính.</td></tr>
      <tr><td>name</td><td>varchar</td><td>255</td><td>Không null.</td></tr>
      <tr><td>slug</td><td>varchar</td><td>255</td><td>Unique, Index.</td></tr>
      <tr><td>logoUrl</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>bannerUrl</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>description</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>status</td><td>enum</td><td>-</td><td>Giá trị: PENDING, ACTIVE, SUSPENDED. Mặc định PENDING.</td></tr>
      <tr><td>averageRating</td><td>float</td><td>-</td><td>Mặc định 0.</td></tr>
      <tr><td>totalSales</td><td>int</td><td>-</td><td>Mặc định 0.</td></tr>
      <tr><td>ownerId</td><td>varchar</td><td>255</td><td>Unique, FK → User.id.</td></tr>
      <tr><td>createdAt</td><td>datetime</td><td>-</td><td>Mặc định <code>now()</code>.</td></tr>
      <tr><td>updatedAt</td><td>datetime</td><td>-</td><td>Tự động cập nhật.</td></tr>
    </tbody>
  </table>

  <h2>Bảng Category</h2>
  <p>Mục đích: quản lý danh mục sản phẩm (hỗ trợ phân cấp).</p>
  <table>
    <thead><tr><th>Trường</th><th>Kiểu dữ liệu</th><th>Độ lớn</th><th>Mô tả</th></tr></thead>
    <tbody>
      <tr><td>id</td><td>varchar</td><td>255</td><td>Khóa chính.</td></tr>
      <tr><td>name</td><td>varchar</td><td>255</td><td>Không null.</td></tr>
      <tr><td>slug</td><td>varchar</td><td>255</td><td>Unique, Index.</td></tr>
      <tr><td>imageUrl</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>parentId</td><td>varchar</td><td>255</td><td>FK → Category.id, Index, có thể null.</td></tr>
      <tr><td>createdAt</td><td>datetime</td><td>-</td><td>Mặc định <code>now()</code>.</td></tr>
      <tr><td>updatedAt</td><td>datetime</td><td>-</td><td>Tự động cập nhật.</td></tr>
    </tbody>
  </table>

  <h2>Bảng Product</h2>
  <p>Mục đích: lưu thông tin sản phẩm.</p>
  <table>
    <thead><tr><th>Trường</th><th>Kiểu dữ liệu</th><th>Độ lớn</th><th>Mô tả</th></tr></thead>
    <tbody>
      <tr><td>id</td><td>varchar</td><td>255</td><td>Khóa chính.</td></tr>
      <tr><td>title</td><td>varchar</td><td>255</td><td>Không null.</td></tr>
      <tr><td>description</td><td>text</td><td>-</td><td>Không null.</td></tr>
      <tr><td>images</td><td>json</td><td>-</td><td>Không null.</td></tr>
      <tr><td>basePrice</td><td>decimal</td><td>10,2</td><td>Không null.</td></tr>
      <tr><td>status</td><td>enum</td><td>-</td><td>Giá trị: DRAFT, PUBLISHED, ARCHIVED. Mặc định DRAFT.</td></tr>
      <tr><td>shopId</td><td>varchar</td><td>255</td><td>FK → Shop.id, Index.</td></tr>
      <tr><td>categoryId</td><td>varchar</td><td>255</td><td>FK → Category.id, Index.</td></tr>
      <tr><td>createdAt</td><td>datetime</td><td>-</td><td>Mặc định <code>now()</code>.</td></tr>
      <tr><td>updatedAt</td><td>datetime</td><td>-</td><td>Tự động cập nhật.</td></tr>
    </tbody>
  </table>

  <h2>Bảng ProductVariant</h2>
  <p>Mục đích: lưu biến thể của sản phẩm (kích thước, màu, v.v.).</p>
  <table>
    <thead><tr><th>Trường</th><th>Kiểu dữ liệu</th><th>Độ lớn</th><th>Mô tả</th></tr></thead>
    <tbody>
      <tr><td>id</td><td>varchar</td><td>255</td><td>Khóa chính.</td></tr>
      <tr><td>productId</td><td>varchar</td><td>255</td><td>FK → Product.id, Index.</td></tr>
      <tr><td>name</td><td>varchar</td><td>255</td><td>Không null.</td></tr>
      <tr><td>price</td><td>decimal</td><td>10,2</td><td>Có thể null.</td></tr>
      <tr><td>stock</td><td>int</td><td>-</td><td>Mặc định 0.</td></tr>
      <tr><td>sku</td><td>varchar</td><td>255</td><td>Unique.</td></tr>
      <tr><td>attributes</td><td>json</td><td>-</td><td>Không null.</td></tr>
      <tr><td>createdAt</td><td>datetime</td><td>-</td><td>Mặc định <code>now()</code>.</td></tr>
      <tr><td>updatedAt</td><td>datetime</td><td>-</td><td>Tự động cập nhật.</td></tr>
    </tbody>
  </table>

  <h2>Bảng Order</h2>
  <p>Mục đích: lưu đơn hàng.</p>
  <table>
    <thead><tr><th>Trường</th><th>Kiểu dữ liệu</th><th>Độ lớn</th><th>Mô tả</th></tr></thead>
    <tbody>
      <tr><td>id</td><td>varchar</td><td>255</td><td>Khóa chính.</td></tr>
      <tr><td>buyerId</td><td>varchar</td><td>255</td><td>FK → User.id, Index.</td></tr>
      <tr><td>shopId</td><td>varchar</td><td>255</td><td>FK → Shop.id, Index.</td></tr>
      <tr><td>totalAmount</td><td>decimal</td><td>10,2</td><td>Không null.</td></tr>
      <tr><td>shippingAddress</td><td>json</td><td>-</td><td>Không null.</td></tr>
      <tr><td>status</td><td>enum</td><td>-</td><td>Giá trị: PENDING, PROCESSING, SHIPPED, DELIVERED, CANCELLED.</td></tr>
      <tr><td>paymentStatus</td><td>enum</td><td>-</td><td>Giá trị: UNPAID, PAID, REFUNDED. Mặc định UNPAID.</td></tr>
      <tr><td>createdAt</td><td>datetime</td><td>-</td><td>Mặc định <code>now()</code>.</td></tr>
      <tr><td>updatedAt</td><td>datetime</td><td>-</td><td>Tự động cập nhật.</td></tr>
    </tbody>
  </table>

  <h2>Bảng OrderItem</h2>
  <p>Mục đích: chi tiết sản phẩm trong đơn hàng.</p>
  <table>
    <thead><tr><th>Trường</th><th>Kiểu dữ liệu</th><th>Độ lớn</th><th>Mô tả</th></tr></thead>
    <tbody>
      <tr><td>id</td><td>varchar</td><td>255</td><td>Khóa chính.</td></tr>
      <tr><td>orderId</td><td>varchar</td><td>255</td><td>FK → Order.id, Index.</td></tr>
      <tr><td>productId</td><td>varchar</td><td>255</td><td>FK → Product.id, Index.</td></tr>
      <tr><td>productVariantId</td><td>varchar</td><td>255</td><td>FK → ProductVariant.id, Index, có thể null.</td></tr>
      <tr><td>quantity</td><td>int</td><td>-</td><td>Không null.</td></tr>
      <tr><td>price</td><td>decimal</td><td>10,2</td><td>Không null.</td></tr>
      <tr><td>createdAt</td><td>datetime</td><td>-</td><td>Mặc định <code>now()</code>.</td></tr>
      <tr><td>updatedAt</td><td>datetime</td><td>-</td><td>Tự động cập nhật.</td></tr>
    </tbody>
  </table>

  <h2>Bảng Transaction</h2>
  <p>Mục đích: lưu giao dịch ví/tài khoản của người dùng.</p>
  <table>
    <thead><tr><th>Trường</th><th>Kiểu dữ liệu</th><th>Độ lớn</th><th>Mô tả</th></tr></thead>
    <tbody>
      <tr><td>id</td><td>varchar</td><td>255</td><td>Khóa chính.</td></tr>
      <tr><td>userId</td><td>varchar</td><td>255</td><td>FK → User.id, Index.</td></tr>
      <tr><td>amount</td><td>decimal</td><td>10,2</td><td>Không null.</td></tr>
      <tr><td>type</td><td>enum</td><td>-</td><td>Giá trị: DEPOSIT, PURCHASE, REFUND.</td></tr>
      <tr><td>status</td><td>enum</td><td>-</td><td>Giá trị: PENDING, SUCCESS, FAILED. Index. Mặc định PENDING.</td></tr>
      <tr><td>description</td><td>text</td><td>-</td><td>Có thể null.</td></tr>
      <tr><td>createdAt</td><td>datetime</td><td>-</td><td>Mặc định <code>now()</code>.</td></tr>
      <tr><td>updatedAt</td><td>datetime</td><td>-</td><td>Tự động cập nhật.</td></tr>
    </tbody>
  </table>

  <h2>Bảng Review</h2>
  <p>Mục đích: lưu đánh giá của người dùng cho sản phẩm.</p>
  <table>
    <thead><tr><th>Trường</th><th>Kiểu dữ liệu</th><th>Độ lớn</th><th>Mô tả</th></tr></thead>
    <tbody>
      <tr><td>id</td><td>varchar</td><td>255</td><td>Khóa chính.</td></tr>
      <tr><td>rating</td><td>int</td><td>-</td><td>Không null.</td></tr>
      <tr><td>comment</td><td>text</td><td>-</td><td>Có thể null.</td></tr>
      <tr><td>images</td><td>json</td><td>-</td><td>Không null.</td></tr>
      <tr><td>userId</td><td>varchar</td><td>255</td><td>FK → User.id, Index.</td></tr>
      <tr><td>productId</td><td>varchar</td><td>255</td><td>FK → Product.id, Index.</td></tr>
      <tr><td>createdAt</td><td>datetime</td><td>-</td><td>Mặc định <code>now()</code>.</td></tr>
      <tr><td>updatedAt</td><td>datetime</td><td>-</td><td>Tự động cập nhật.</td></tr>
    </tbody>
  </table>

  <h2>Bảng TokenPurchase</h2>
  <p>Mục đích: lưu giao dịch mua token qua Stripe.</p>
  <table>
    <thead><tr><th>Trường</th><th>Kiểu dữ liệu</th><th>Độ lớn</th><th>Mô tả</th></tr></thead>
    <tbody>
      <tr><td>id</td><td>varchar</td><td>255</td><td>Khóa chính.</td></tr>
      <tr><td>userId</td><td>varchar</td><td>255</td><td>FK → User.id, Index.</td></tr>
      <tr><td>stripePaymentId</td><td>varchar</td><td>255</td><td>Unique.</td></tr>
      <tr><td>amount</td><td>decimal</td><td>10,2</td><td>Không null.</td></tr>
      <tr><td>tokens</td><td>int</td><td>-</td><td>Không null.</td></tr>
      <tr><td>status</td><td>enum</td><td>-</td><td>Giá trị: pending, completed, failed. Mặc định pending.</td></tr>
      <tr><td>createdAt</td><td>datetime</td><td>-</td><td>Mặc định <code>now()</code>.</td></tr>
    </tbody>
  </table>

  <h2>Bảng CostTracking</h2>
  <p>Mục đích: theo dõi chi phí sử dụng dịch vụ.</p>
  <table>
    <thead><tr><th>Trường</th><th>Kiểu dữ liệu</th><th>Độ lớn</th><th>Mô tả</th></tr></thead>
    <tbody>
      <tr><td>id</td><td>varchar</td><td>255</td><td>Khóa chính.</td></tr>
      <tr><td>userId</td><td>varchar</td><td>255</td><td>FK → User.id, Index (ghép với service), có thể null.</td></tr>
      <tr><td>service</td><td>varchar</td><td>255</td><td>Không null.</td></tr>
      <tr><td>operation</td><td>varchar</td><td>255</td><td>Không null.</td></tr>
      <tr><td>cost</td><td>int</td><td>-</td><td>Mặc định 0.</td></tr>
      <tr><td>details</td><td>text</td><td>-</td><td>Có thể null.</td></tr>
      <tr><td>createdAt</td><td>datetime</td><td>-</td><td>Mặc định <code>now()</code>. Index tổng hợp: (userId, service).</td></tr>
    </tbody>
  </table>

  <h2>Bảng VirtualModel</h2>
  <p>Mục đích: lưu cấu hình avatar/mô hình ảo của người dùng.</p>
  <table>
    <thead><tr><th>Trường</th><th>Kiểu dữ liệu</th><th>Độ lớn</th><th>Mô tả</th></tr></thead>
    <tbody>
      <tr><td>id</td><td>varchar</td><td>255</td><td>Khóa chính.</td></tr>
      <tr><td>userId</td><td>varchar</td><td>255</td><td>FK → User.id, Index, có thể null.</td></tr>
      <tr><td>sessionId</td><td>varchar</td><td>255</td><td>Index, có thể null.</td></tr>
      <tr><td>avatarName</td><td>varchar</td><td>255</td><td>Không null.</td></tr>
      <tr><td>avatarImage</td><td>longtext</td><td>-</td><td>Có thể null.</td></tr>
      <tr><td>isPublic</td><td>boolean</td><td>-</td><td>Mặc định false.</td></tr>
      <tr><td>height</td><td>float</td><td>-</td><td>Không null.</td></tr>
      <tr><td>weight</td><td>float</td><td>-</td><td>Không null.</td></tr>
      <tr><td>gender</td><td>varchar</td><td>255</td><td>Không null.</td></tr>
      <tr><td>hairColor</td><td>varchar</td><td>255</td><td>Không null.</td></tr>
      <tr><td>hairStyle</td><td>varchar</td><td>255</td><td>Không null.</td></tr>
      <tr><td>bodyShape</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>skinTone</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>eyeColor</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>faceShape</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>beardStyle</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>tattoos</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>piercings</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>clothingStyle</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>accessories</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>footwearType</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>colorPalette</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>ageAppearance</td><td>int</td><td>-</td><td>Có thể null.</td></tr>
      <tr><td>bodyProportionPreset</td><td>varchar</td><td>255</td><td>Có thể null.</td></tr>
      <tr><td>muscleLevel</td><td>int</td><td>-</td><td>Có thể null.</td></tr>
      <tr><td>fatLevel</td><td>int</td><td>-</td><td>Có thể null.</td></tr>
      <tr><td>shoulderWidth</td><td>float</td><td>-</td><td>Có thể null.</td></tr>
      <tr><td>waistSize</td><td>float</td><td>-</td><td>Có thể null.</td></tr>
      <tr><td>hipSize</td><td>float</td><td>-</td><td>Có thể null.</td></tr>
      <tr><td>legLength</td><td>float</td><td>-</td><td>Có thể null.</td></tr>
      <tr><td>createdAt</td><td>datetime</td><td>-</td><td>Mặc định <code>now()</code>.</td></tr>
      <tr><td>updatedAt</td><td>datetime</td><td>-</td><td>Tự động cập nhật.</td></tr>
    </tbody>
  </table>

  <h2>Bảng BlogPost</h2>
  <p>Mục đích: bài viết blog của người dùng.</p>
  <table>
    <thead><tr><th>Trường</th><th>Kiểu dữ liệu</th><th>Độ lớn</th><th>Mô tả</th></tr></thead>
    <tbody>
      <tr><td>id</td><td>varchar</td><td>255</td><td>Khóa chính.</td></tr>
      <tr><td>authorId</td><td>varchar</td><td>255</td><td>FK → User.id, Index.</td></tr>
      <tr><td>title</td><td>varchar</td><td>255</td><td>Không null.</td></tr>
      <tr><td>content</td><td>longtext</td><td>-</td><td>Không null.</td></tr>
      <tr><td>media</td><td>json</td><td>-</td><td>Không null.</td></tr>
      <tr><td>category</td><td>varchar</td><td>255</td><td>Index, có thể null.</td></tr>
      <tr><td>tags</td><td>json</td><td>-</td><td>Không null.</td></tr>
      <tr><td>status</td><td>enum</td><td>-</td><td>Giá trị: DRAFT, PUBLISHED, ARCHIVED. Index. Mặc định PUBLISHED.</td></tr>
      <tr><td>likesCount</td><td>int</td><td>-</td><td>Mặc định 0.</td></tr>
      <tr><td>savesCount</td><td>int</td><td>-</td><td>Mặc định 0.</td></tr>
      <tr><td>commentsCount</td><td>int</td><td>-</td><td>Mặc định 0.</td></tr>
      <tr><td>createdAt</td><td>datetime</td><td>-</td><td>Mặc định <code>now()</code>.</td></tr>
      <tr><td>updatedAt</td><td>datetime</td><td>-</td><td>Tự động cập nhật.</td></tr>
    </tbody>
  </table>

  <h2>Bảng BlogComment</h2>
  <p>Mục đích: bình luận cho bài viết blog.</p>
  <table>
    <thead><tr><th>Trường</th><th>Kiểu dữ liệu</th><th>Độ lớn</th><th>Mô tả</th></tr></thead>
    <tbody>
      <tr><td>id</td><td>varchar</td><td>255</td><td>Khóa chính.</td></tr>
      <tr><td>postId</td><td>varchar</td><td>255</td><td>FK → BlogPost.id, Index.</td></tr>
      <tr><td>userId</td><td>varchar</td><td>255</td><td>FK → User.id, Index.</td></tr>
      <tr><td>content</td><td>longtext</td><td>-</td><td>Không null.</td></tr>
      <tr><td>media</td><td>json</td><td>-</td><td>Không null.</td></tr>
      <tr><td>createdAt</td><td>datetime</td><td>-</td><td>Mặc định <code>now()</code>.</td></tr>
      <tr><td>updatedAt</td><td>datetime</td><td>-</td><td>Tự động cập nhật.</td></tr>
    </tbody>
  </table>

  <h2>Bảng BlogLike</h2>
  <p>Mục đích: lưu lượt thích cho bài viết.</p>
  <table>
    <thead><tr><th>Trường</th><th>Kiểu dữ liệu</th><th>Độ lớn</th><th>Mô tả</th></tr></thead>
    <tbody>
      <tr><td>id</td><td>varchar</td><td>255</td><td>Khóa chính.</td></tr>
      <tr><td>postId</td><td>varchar</td><td>255</td><td>FK → BlogPost.id.</td></tr>
      <tr><td>userId</td><td>varchar</td><td>255</td><td>FK → User.id, Index.</td></tr>
      <tr><td>createdAt</td><td>datetime</td><td>-</td><td>Mặc định <code>now()</code>.</td></tr>
      <tr><td>(ràng buộc)</td><td>-</td><td>-</td><td>UNIQUE(postId, userId).</td></tr>
    </tbody>
  </table>

  <h2>Bảng BlogSave</h2>
  <p>Mục đích: lưu lượt lưu bài viết.</p>
  <table>
    <thead><tr><th>Trường</th><th>Kiểu dữ liệu</th><th>Độ lớn</th><th>Mô tả</th></tr></thead>
    <tbody>
      <tr><td>id</td><td>varchar</td><td>255</td><td>Khóa chính.</td></tr>
      <tr><td>postId</td><td>varchar</td><td>255</td><td>FK → BlogPost.id.</td></tr>
      <tr><td>userId</td><td>varchar</td><td>255</td><td>FK → User.id, Index.</td></tr>
      <tr><td>createdAt</td><td>datetime</td><td>-</td><td>Mặc định <code>now()</code>.</td></tr>
      <tr><td>(ràng buộc)</td><td>-</td><td>-</td><td>UNIQUE(postId, userId).</td></tr>
    </tbody>
  </table>

  <p class="note">Ghi chú: Kiểu enum được khai báo trong <code>schema.prisma</code> và được tạo tương ứng trong MySQL. Các trường thời gian sử dụng <code>datetime</code> với mặc định <code>now()</code> hoặc tự động cập nhật.</p>
</body>
</html>
