@startuml
skinparam linetype ortho
start
:Đọc cookie token;
if (Hợp lệ?) then (Có)
  :Đọc action (create/moderate/delete);
  if (Action?) then (create)
    :Parse body: postId, content;
    :Validate bắt buộc;
    :Prisma: tìm bài viết published;
    if (Tồn tại?) then (Có)
      :Prisma: tạo comment (status=pending/approved theo chính sách);
      :200: Trả comment mới;
    else (Không)
      :404: Bài viết không tồn tại/không xuất bản;
    endif
  elseif (moderate)
    :Kiểm tra vai trò Admin;
    if (Đủ quyền?) then (Có)
      :Parse body: commentId, decision=approve/reject;
      :Prisma: tìm comment;
      if (Tồn tại?) then (Có)
        :Prisma: cập nhật status;
        :200: Trả success;
      else (Không)
        :404: Comment không tồn tại;
      endif
    else (Không)
      :403: Forbidden;
    endif
  else (delete)
    :Kiểm tra vai trò Admin hoặc chủ comment;
    if (Đủ quyền?) then (Có)
      :Parse body: commentId;
      :Prisma: xoá comment;
      :200: Trả success;
    else (Không)
      :403: Forbidden;
    endif
  endif
  end
else (Không)
  :401: Unauthorized;
  end
endif
@enduml
