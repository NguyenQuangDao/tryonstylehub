Spec: Thử đồ ảo (TryOn)

---
TryOn_Upload

| Mục | Nội dung |
|---|---|
| Mục tiêu | Nhận ảnh đầu vào từ người dùng |
| Đầu vào | File ảnh JPEG/PNG ≤ 10MB; tùy chọn: chiều cao/cân nặng |
| Xử lý | Xác thực định dạng/kích thước; loại bỏ EXIF; quét virus |
| Đầu ra | `imageId` tạm thời; URL nội bộ |
| Tích hợp ngoài | Không trực tiếp |
| Ràng buộc | Bảo mật dữ liệu hình ảnh; không lưu PII trong EXIF |
| Lỗi | `INVALID_FORMAT`, `FILE_TOO_LARGE`, `UPLOAD_FAILED` |
| KPI | Tỉ lệ upload thành công; thời gian upload trung bình |

---
TryOn_Select

| Mục | Nội dung |
|---|---|
| Mục tiêu | Chọn trang phục và size phù hợp |
| Đầu vào | Danh sách `productId`, `size`, biến thể |
| Xử lý | Kiểm tra hợp lệ; ánh xạ size; kiểm tra khả dụng |
| Đầu ra | Danh sách item đã chọn với cấu hình |
| Tích hợp ngoài | Không trực tiếp |
| Ràng buộc | Đồng bộ với danh mục/giá; tránh item hết hàng |
| Lỗi | `ITEM_NOT_FOUND`, `SIZE_UNAVAILABLE` |
| KPI | Tỉ lệ chọn thành công; số lần thay đổi lựa chọn |

---
TryOn_AI

| Mục | Nội dung |
|---|---|
| Mục tiêu | Xử lý fitting AI trên ảnh người dùng |
| Đầu vào | `imageId`, danh sách item đã chọn, tham số mô hình |
| Xử lý | Gọi API AI; theo dõi tiến trình; retry theo backoff |
| Đầu ra | `resultId`, ảnh/mesh kết quả |
| Tích hợp ngoài | `actorAI` (Dịch vụ AI Try-On) |
| Ràng buộc | SLA < 10s; giới hạn tốc độ; timeout/huỷ |
| Lỗi | `AI_TIMEOUT`, `AI_ERROR`, `AI_RATE_LIMIT` |
| KPI | Thời gian xử lý; tỉ lệ thành công AI |

---
TryOn_Render

| Mục | Nội dung |
|---|---|
| Mục tiêu | Kết xuất ảnh/video kết quả chất lượng cao |
| Đầu vào | `resultId`, cấu hình render (độ phân giải, định dạng) |
| Xử lý | Post-process, upscale, ánh sáng/nền |
| Đầu ra | URL file kết quả |
| Tích hợp ngoài | `actorCDN` (lưu trữ kết quả) |
| Ràng buộc | Kích thước ≤ 25MB; định dạng web-friendly |
| Lỗi | `RENDER_FAILED`, `CDN_UPLOAD_FAILED` |
| KPI | Thời gian render; tỷ lệ CDN upload thành công |

---
TryOn_Save

| Mục | Nội dung |
|---|---|
| Mục tiêu | Lưu, chia sẻ kết quả cho người dùng |
| Đầu vào | URL kết quả, metadata chia sẻ |
| Xử lý | Lưu vào lịch sử; tạo liên kết chia sẻ; đặt TTL |
| Đầu ra | `shareUrl`, bản ghi lịch sử |
| Tích hợp ngoài | `actorCDN` (liên kết công khai) |
| Ràng buộc | Quyền riêng tư/TTL; thu hồi liên kết |
| Lỗi | `SAVE_FAILED`, `LINK_EXPIRED` |
| KPI | Tỉ lệ chia sẻ; lượt xem kết quả |

